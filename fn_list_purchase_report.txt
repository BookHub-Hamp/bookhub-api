CREATE OR REPLACE FUNCTION fn_list_purchase_report() 
RETURNS TABLE (
    quantity INT,
    consultdate TEXT
) 
AS $$
BEGIN
    RETURN QUERY 
    SELECT 
        COUNT(*)::int AS quantity, 
        TO_CHAR(p.created_at, 'dd/MM/yyyy') AS consultdate
    FROM purchases p
    GROUP BY TO_CHAR(p.created_at, 'dd/MM/yyyy')
    ORDER BY TO_CHAR(p.created_at, 'dd/MM/yyyy') ASC;
END; $$ 
LANGUAGE plpgsql;


SELECT * FROM fn_list_purchase_report();
